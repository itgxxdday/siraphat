<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Droplet Analysis</title>
    <style>
        /* CSS ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ */
        .container { max-width: 800px; margin: auto; padding: 20px; }
        .image-container { display: flex; justify-content: space-around; margin-top: 20px; }
        .image-box { text-align: center; }
        .image-box img { max-width: 100%; height: auto; border: 1px solid #ccc; }
        .results-box { margin-top: 20px; border: 1px solid #000; padding: 15px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üî¨ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏¢‡∏î‡∏•‡∏∞‡∏≠‡∏≠‡∏á</h2>
        <form id="upload-form">
            <label for="paper_width">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (cm):</label>
            <input type="number" step="0.01" id="paper_width" name="paper_width" required value="7.5" aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (cm)">
            
            <label for="paper_height">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (cm):</label>
            <input type="number" step="0.01" id="paper_height" name="paper_height" required value="5.0" aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (cm)">
            
            <label for="file">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏´‡∏¢‡∏î‡∏•‡∏∞‡∏≠‡∏≠‡∏á (.png, .jpg, .jpeg):</label>
            <input type="file" id="file" name="file" accept=".png,.jpg,.jpeg" required aria-label="‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û">
            
            <button type="submit">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û</button>
        </form>

        <div id="loading" class="hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</div>

        <div id="results" class="hidden results-box">
            <h3>üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏¢‡∏î‡∏•‡∏∞‡∏≠‡∏≠‡∏á:</strong> <span id="count"></span></p>
            <p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô:</strong> <span id="droplets_per_sq_cm"></span></p>
            <p><strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:</strong> <span id="percent_coverage"></span></p>
            <p><strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©:</strong> <span id="paper_area_real"></span></p>
            <p><strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏î‡∏•‡∏∞‡∏≠‡∏≠‡∏á:</strong> <span id="drop_area_real"></span></p>
            <hr>
            <h4>‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û: <span id="efficacy_result"></span></h4>
        </div>

        <div class="image-container">
            <div class="image-box">
                <h4>‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</h4>
                <img id="original-image" class="hidden" alt="‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö">
            </div>
            <div class="image-box">
                <h4>‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏û‡∏£‡πâ‡∏≠‡∏° Contour)</h4>
                <img id="output-image" class="hidden" alt="‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå">
            </div>
        </div>

        <div id="error-message" class="hidden" style="color: red; margin-top: 10px;"></div>
    </div>

    <script>
        document.getElementById('upload-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('original-image').classList.add('hidden');
            document.getElementById('output-image').classList.add('hidden');
            document.getElementById('error-message').classList.add('hidden');

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok || data.error) {
                    const error = data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå';
                    document.getElementById('error-message').textContent = error;
                    document.getElementById('error-message').classList.remove('hidden');
                } else {
                    const results = data.results;
                    
                    document.getElementById('count').textContent = results.count;
                    document.getElementById('droplets_per_sq_cm').textContent = results.droplets_per_sq_cm;
                    document.getElementById('percent_coverage').textContent = results.percent_coverage;
                    document.getElementById('paper_area_real').textContent = results.paper_area_real;
                    document.getElementById('drop_area_real').textContent = results.drop_area_real;
                    document.getElementById('efficacy_result').textContent = results.efficacy_result;

                    document.getElementById('original-image').src = data.original_image;
                    document.getElementById('output-image').src = data.output_image;
                    
                    document.getElementById('results').classList.remove('hidden');
                    document.getElementById('original-image').classList.remove('hidden');
                    document.getElementById('output-image').classList.remove('hidden');
                }
            } catch (error) {
                document.getElementById('error-message').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message;
                document.getElementById('error-message').classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        });
    </script>
</body>
</html>